<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vaporwave Kalkulator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'VT323', monospace;
    }
    #bg-grid {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      background: linear-gradient(#000000 2px, transparent 2px), linear-gradient(to right, #000000 2px, transparent 2px);
      background-size: 20px 20px;
      opacity: 0.05;
    }
    .btn {
      background-color: #1f1f1f;
      color: white;
      font-size: 1.5rem;
      padding: 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #555;
    }
    .btn:hover {
      background-color: #333;
    }
    input::placeholder {
      color: #aaa;
    }
    .spotify-player button {
      font-family: monospace;
    }
  </style>
</head>
<body class="bg-black text-white p-4">

  <!-- Tło -->
  <div id="bg-grid"></div>

  <!-- NAGŁÓWEK -->
  <header class="w-full text-center text-white text-2xl font-mono py-4">
    made by Marcin Rybak no license required
  </header>

  <!-- GŁÓWNA ZAWARTOŚĆ -->
  <div class="flex-grow flex justify-center gap-6 mt-4">

    <!-- LEWA STRONA: Kalkulator -->
    <div class="w-[30%] flex flex-col items-center gap-4">
      <div id="display" class="w-full text-left text-green-400 text-3xl bg-[#2d2d2d] px-4 py-2 rounded-full">0</div>

      <div class="grid grid-cols-4 gap-2 w-full">
        <button class="btn">7</button>
        <button class="btn">8</button>
        <button class="btn">9</button>
        <button class="btn">/</button>

        <button class="btn">4</button>
        <button class="btn">5</button>
        <button class="btn">6</button>
        <button class="btn">*</button>

        <button class="btn">1</button>
        <button class="btn">2</button>
        <button class="btn">3</button>
        <button class="btn">-</button>

        <button class="btn">0</button>
        <button class="btn">.</button>
        <button class="btn">+</button>
        <button class="btn">=</button>

        <button class="btn">C</button>
        <button class="btn">^</button>
        <button class="btn">%</button>
        <button class="btn">√</button>
      </div>

      <input id="functionInput" type="text" class="w-full bg-[#2d2d2d] text-white px-4 py-2 rounded-full" placeholder="enter function" />
    </div>

    <!-- PRAWA STRONA: Wykres -->
    <div class="w-[30%] h-[30vh]">
      <canvas id="graphCanvas" class="bg-black w-full h-full rounded-xl"></canvas>
    </div>
  </div>

  <!-- ODTWARZACZ -->
  <div class="fixed bottom-2 left-1/2 -translate-x-1/2 w-2/3 bg-black bg-opacity-80 px-4 py-2 flex items-center justify-between rounded-full spotify-player border border-white text-white">
    <div class="flex items-center gap-4">
      <button id="toggleMuteBtn" onclick="toggleMute()">volume</button>
      <button onclick="prevTrack()">&lt;&lt;</button>
    </div>
    <marquee behavior="scroll" direction="left" class="text-white text-sm text-center flex-1 px-4" id="trackTitle">Loading track...</marquee>
    <button onclick="nextTrack()">&gt;&gt;</button>
  </div>

  <!-- YT IFRAME -->
  <iframe id="yt-iframe" style="display:none;" allow="autoplay"></iframe>

  <script>
    // Kalkulator
    const display = document.getElementById('display');
    const buttons = document.querySelectorAll('.btn');
    let input = '';

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const val = btn.textContent;
        if (val === 'C') input = '';
        else if (val === '=') {
          try {
            input = eval(input.replaceAll('^', '**')).toString();
          } catch {
            input = 'ERROR';
          }
        } else if (val === '√') {
          input = Math.sqrt(parseFloat(input)).toString();
        } else {
          input += val;
        }
        display.textContent = input || '0';
      });
    });

    // Wykres
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;

    function drawAxes() {
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(0, canvas.height / 2);
      ctx.lineTo(canvas.width, canvas.height / 2);
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
    }

    function drawFunction(expr) {
      const step = 1;
      const scale = 20;
      ctx.beginPath();
      for (let x = -canvas.width / 2; x < canvas.width / 2; x += step) {
        try {
          const xVal = x / scale;
          const yVal = evaluateExpression(expr.replaceAll('x', `(${xVal})`));
          const screenX = canvas.width / 2 + x;
          const screenY = canvas.height / 2 - yVal * scale;
          if (x === -canvas.width / 2) ctx.moveTo(screenX, screenY);
          else ctx.lineTo(screenX, screenY);
        } catch {}
      }
      ctx.strokeStyle = '#00ffff';
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function evaluateExpression(expr) {
      // Prostym parserem wyrażenia matematycznego
      return Function('"use strict";return (' + expr + ')')();
    }

    function parseInput(input) {
      input = input.replace(/\s+/g, '').toLowerCase().replace(/([0-9])x/g, '$1*x');
      if (!input.includes('=')) return null;
      const [lhs, rhs] = input.split('=');
      if (lhs.includes('y')) return rhs;
      if (rhs.includes('y')) return lhs;
      return null;
    }

    functionInput.addEventListener('input', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawAxes();
      const expr = parseInput(functionInput.value);
      if (expr) drawFunction(expr);
    });

    drawAxes();

    // Odtwarzacz
    const tracks = [
      { title: "vaporwave tape 1", embed: "https://www.youtube.com/embed/4xDzrJKXOOY?autoplay=1&mute=0" },
      { title: "vaporwave mix", embed: "https://www.youtube.com/embed/f02mOEt11OQ?autoplay=1&mute=0" }
    ];
    let currentTrack = Math.floor(Math.random() * tracks.length);
    let muted = false;

    function loadTrack() {
      const iframe = document.getElementById('yt-iframe');
      const track = tracks[currentTrack];
      const src = track.embed.replace(/mute=(0|1)/, `mute=${muted ? 1 : 0}`);
      iframe.src = src;
      document.getElementById('trackTitle').textContent = track.title;
      document.getElementById('toggleMuteBtn').textContent = muted ? 'volume' : 'mute';
    }

    function nextTrack() {
      currentTrack = (currentTrack + 1) % tracks.length;
      loadTrack();
    }

    function prevTrack() {
      currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
      loadTrack();
    }

    function toggleMute() {
      muted = !muted;
      loadTrack();
    }

    loadTrack();
  </script>
</body>
</html>
